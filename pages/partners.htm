url = "/partners"
layout = "default"
title = "Partners"
is_hidden = 0
robot_index = "index"
robot_follow = "follow"
header_image = "about.jpg"

[jumbotron partners]
jumbotron = "partners"
background = "transperant"
templates = "template3"
description_limit = 0

[jumbotron projects]
jumbotron = "concerto-partners-are-involved-series-projects-listed-below"
title = 0
background = "transperant"
templates = "template3"
description_limit = 0
==
<?php
use Pensoft\Partners\Models\Partners;
use Pensoft\Cardprofiles\Models\Profiles;

function onStart(){
	$this['partners'] = Partners::where('type', 1)->get();
    $this['members'] = Profiles::where('category_id', 2)->get();

    // Group partners by country_code
    $this['country_partners'] = Partners::where('type', 1)
        ->get()
        ->groupBy('country_code');

    $this['insider_members'] = new class {
        public function getIM($id) {
            return Profiles::where('partner_id', $id)
            ->where('category_id', 2)
            ->orderBy('names')
            ->get();
        }
    };
}

function onPartners(){
$this['partners'] = [];
$this['code'] = post('code');
if(post('code')){
$this['partners'] =  Partners::whereRaw('country_code ILIKE \'%'.post('code').'%\'')->where('type', 1)->get();
}
$this['insider_members'] = new class {
public function getIM($id) {
return Profiles::where('partner_id', $id)->where('category_id',  2)->orderBy('names')->get();
}
};
}

function onSinglePartner(){
$this['partners'] = [];
if(post('partner_id')){
$this['partners'] =  Partners::where('id', post('partner_id'))->where('type', 1)->get();
}
$this['insider_members'] = new class {
public function getIM($id) {
return Profiles::where('partner_id', $id)->where('category_id',  2)->orderBy('names')->get();
}
};
}


function onGetPartnerLogos(){
    $code = post('code');

    if(!$code){
        return response()->json([]);
    }

    $partners = Partners::whereRaw('country_code ILIKE \'%'.$code.'%\'')
    ->where('type', 1)
    ->get()
    ->map(function($p){
        return [
            'id'   => $p->id,
            'name' => $p->instituion,
            'logo' => $p->cover ? $p->cover->path : null,
        ];
    });

    return response()->json($partners);
}

?>
==
<div class="container-fluid partners_background">

    <div class="container">
        <section aria-labelledby="partners-heading">
            <span class="tooltiptext" id="tooltip" aria-live="polite">Bulgaria</span>

            <div class="row">
                <div class="col-md-12 col-xs-12 partners_intro">
                    <h1 id="partners-heading" class="sr-only">Partners</h1>
                    {% component 'partners' %}
                </div>
                <div class="col-md-12 col-xs-12">
                    <div class="svg_map" role="img" aria-label="Interactive map of partner locations across Europe">
                        {% partial 'components/svg' %}
                    </div>
                </div>
            </div>

            {% for country_code, group in country_partners %}
            <div class="control-popup modal fade"
                 id="country_modal_{{ country_code|lower }}"
                 tabindex="-1"
                 role="dialog"
                 aria-labelledby="country-modal-title-{{ country_code|lower }}"
                 aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <button type="button" class="close" data-dismiss="modal"
                                aria-label="Close dialog">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 18 18" fill="none" aria-hidden="true" focusable="false">
                                <path d="M16.3887 0.290956L9.00094 7.67954L1.61314 0.290956C1.43545 0.128339 1.20188 0.0405543 0.961087 0.0458903C0.72029 0.0512262 0.490836 0.149271 0.320525 0.3196C0.150215 0.489929 0.0521799 0.719407 0.0468446 0.96023C0.0415092 1.20105 0.129284 1.43465 0.291884 1.61235L7.67593 9.00094L0.29001 16.3876C0.199776 16.4736 0.127643 16.5768 0.0778516 16.6911C0.0280603 16.8054 0.00161536 16.9285 7.17197e-05 17.0531C-0.00147192 17.1778 0.0219169 17.3015 0.0688628 17.417C0.115809 17.5324 0.185364 17.6374 0.273442 17.7256C0.361519 17.8138 0.46634 17.8835 0.581743 17.9306C0.697146 17.9777 0.820803 18.0013 0.945444 17.9999C1.07008 17.9986 1.19319 17.9723 1.30754 17.9227C1.42188 17.873 1.52515 17.801 1.61127 17.7109L9.00094 10.3242L16.3887 17.7128C16.5664 17.8754 16.8 17.9632 17.0408 17.9579C17.2816 17.9525 17.511 17.8545 17.6813 17.6842C17.8517 17.5138 17.9497 17.2843 17.955 17.0435C17.9604 16.8027 17.8726 16.5691 17.71 16.3914L10.3222 9.00281L17.71 1.61235C17.8002 1.52635 17.8724 1.42318 17.9221 1.30889C17.9719 1.19461 17.9984 1.07152 17.9999 0.94687C18.0015 0.822218 17.9781 0.698515 17.9311 0.583033C17.8842 0.467551 17.8146 0.36262 17.7266 0.274408C17.6385 0.186196 17.5337 0.116484 17.4183 0.0693699C17.3029 0.0222553 17.1792 -0.00131087 17.0546 5.62491e-05C16.9299 0.00142337 16.8068 0.0276964 16.6925 0.077331C16.5781 0.126966 16.4749 0.19896 16.3887 0.289082V0.290956Z" fill="#00b89c"></path>
                            </svg>
                            <span class="sr-only">Close</span>
                        </button>

                        <!-- Back button (hidden by default) -->
                        <button type="button" class="back-btn" style="display:none;"
                                aria-label="Back to partner info">
                            <svg xmlns="http://www.w3.org/2000/svg" width="8" height="14" viewBox="0 0 8 14" fill="none">
                                <path d="M7 1L1 7L7 13" stroke="#FBFDFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>

                        <div class="row">
                            <!-- LEFT: Partner logos -->
                            <div class="col-md-4 col-xs-12 partner_logos_sidebar">
                                <div class="partner_logos_list" data-count="{{ group|length }}">
                                    {% for i, partner in group %}
                                    <div class="partner_logo_item {% if loop.first %}active{% endif %}"
                                         data-partner-id="{{ partner.id }}"
                                         data-modal="{{ country_code|lower }}"
                                         role="button"
                                         tabindex="0"
                                         aria-label="Show details for {{ partner.instituion }}">
                                        <img src="{{ partner.cover.path }}" alt="{{ partner.instituion }} logo">
                                    </div>
                                    {% endfor %}
                                </div>
                                <div class="country_label">{{ group[0].name }}</div>
                            </div>

                            <!-- RIGHT: Partner details -->
                            <div class="col-md-8 col-xs-12 partner_detail_panels">
                                {% for i, partner in group %}
                                <div class="partner_detail_panel {% if loop.first %}active{% endif %}"
                                     data-partner-id="{{ partner.id }}"
                                     data-modal="{{ country_code|lower }}">

                                    <!-- INFO VIEW -->
                                    <div class="panel_info_view">
                                        <div class="title_and_link">
                                            <h3 class="partner_title">{{ partner.instituion }}</h3>
                                            <div class="partner_description">{{ partner.content|raw }}</div>
                                            <div class="partner_link">
                                                {% if insider_members.getIM(partner.id).count > 0 %}
                                                <a href="javascript:void(0);"
                                                   class="btn btn-primary btn-view-members"
                                                   data-partner-id="{{ partner.id }}"
                                                   data-modal="{{ country_code|lower }}"
                                                   aria-label="View {{ partner.instituion }} members">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 21 21" fill="none">
                                                        <path d="M11.207 17.2419V15.5177C11.207 13.137 9.27707 11.2072 6.89644 11.2072C4.51582 11.2072 2.58594 13.137 2.58594 15.5177V17.2419H11.207ZM11.207 17.2419H18.1038V16.3798C18.1038 13.8404 16.1739 12.0693 13.7933 12.0693C12.5748 12.0693 11.4745 12.6085 10.6905 13.4754M9.48275 6.03455C9.48275 7.46292 8.32482 8.62085 6.89644 8.62085C5.46807 8.62085 4.31014 7.46292 4.31014 6.03455C4.31014 4.60617 5.46807 3.44824 6.89644 3.44824C8.32482 3.44824 9.48275 4.60617 9.48275 6.03455ZM15.5175 7.75875C15.5175 8.711 14.7455 9.48295 13.7933 9.48295C12.841 9.48295 12.0691 8.711 12.0691 7.75875C12.0691 6.8065 12.841 6.03455 13.7933 6.03455C14.7455 6.03455 15.5175 6.8065 15.5175 7.75875Z" stroke="#ECF1FA" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                                    </svg>
                                                    Visit Members
                                                </a>
                                                {% endif %}

                                                <a href="{{ partner.instituion_url }}"
                                                   class="btn btn-primary"
                                                   target="_blank"
                                                   rel="noopener noreferrer"
                                                   aria-label="Visit {{ partner.instituion }} website">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="21" height="14" viewBox="0 0 21 14" fill="none">
                                                        <path d="M7.24096 12.3557C7.0026 12.5689 6.81814 12.7116 6.62963 12.8159C5.70685 13.3262 4.56995 13.3262 3.64717 12.8159C3.30713 12.6278 2.98026 12.3146 2.32651 11.6884C1.67277 11.0621 1.3459 10.749 1.14957 10.4232C0.616809 9.53919 0.616809 8.45005 1.14957 7.56605C1.3459 7.2403 1.67277 6.92716 2.32651 6.30088L5.1384 3.60714C5.79214 2.98087 6.11902 2.66773 6.45906 2.47965C7.38183 1.96928 8.51874 1.96928 9.44151 2.47965C9.78156 2.66773 10.1084 2.98087 10.7622 3.60714C11.4159 4.23342 11.7428 4.54656 11.9391 4.87231C12.4719 5.75631 12.4719 6.84545 11.9391 7.72945C11.8303 7.91005 11.6813 8.08676 11.4588 8.3151M8.65962 5.63354C8.43709 5.86188 8.28813 6.03859 8.17929 6.21918C7.64653 7.10318 7.64653 8.19232 8.17929 9.07632C8.37561 9.40208 8.70249 9.71522 9.35623 10.3415C10.01 10.9678 10.3368 11.2809 10.6769 11.469C11.5997 11.9794 12.7366 11.9794 13.6593 11.469C13.9994 11.2809 14.3263 10.9678 14.98 10.3415L17.7919 7.64775C18.4456 7.02148 18.7725 6.70834 18.9688 6.38258C19.5016 5.49858 19.5016 4.40944 18.9688 3.52544C18.7725 3.19969 18.4456 2.88655 17.7919 2.26027C17.1381 1.634 16.8113 1.32086 16.4712 1.13278C15.5485 0.622405 14.4115 0.622405 13.4888 1.13278C13.3003 1.23705 13.1158 1.37975 12.8774 1.59293" stroke="#ECF1FA" stroke-width="1.5" stroke-linecap="square" stroke-linejoin="bevel"/>
                                                    </svg>
                                                    Visit Website
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- MEMBERS VIEW (hidden by default) -->
                                    {% if insider_members.getIM(partner.id).count > 0 %}
                                        <div class="panel_members_view" style="display:none;">
                                        <div class="partners_list_content">
                                            {% for profile in insider_members.getIM(partner.id) %}
                                            <article class="contact_info row">
                                                <div class="col-md-3 col-xs-6 member_avatar">
                                                    {% if profile.avatar %}
                                                    <img alt="Photo of {{ profile.names }}" src="{{ profile.avatar|crop_image }}">
                                                    {% else %}
                                                    <img alt="Default avatar" src="{{ 'avatar.svg'|media }}" width="82" height="67" class="no-image">
                                                    {% endif %}
                                                </div>
                                                <div class="col-md-6 col-xs-6 coordinator_info">
                                                    <h4>{{ profile.names }}</h4>
                                                    {% if profile.position %}
                                                    <div class="position">{{ profile.position }}</div>
                                                    {% endif %}
                                                    {% if profile.email %}
                                                    <div class="position">
                                                        <a href="mailto:{{ profile.email }}" target="_blank">{{ profile.email }}</a>
                                                    </div>
                                                    {% endif %}
                                                </div>
                                                <div class="col-md-3 col-xs-12">
                                                    <div class="read-more" onclick="expandBiography(this);" aria-expanded="false">Biography</div>
                                                </div>
                                                <div class="col-md-12">
                                                    <div class="body" style="display: none;">{{ profile.content|raw }}</div>
                                                </div>
                                            </article>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </section>

    </div>
</div>

